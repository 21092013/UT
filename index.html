<!DOCTYPE html>
<html dir="rtl" lang="he">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UT Bakery</title>
<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:system-ui, Arial, sans-serif;background:#0f172a;color:#f8fafc}
header{background:#020617;padding:20px;text-align:center;border-bottom:3px solid #38bdf8}
header h1{font-size:1.8rem}
header p{color:#94a3b8;font-size:0.95rem}
.container{max-width:960px;margin:auto;padding:20px 14px 60px}
.products{display:grid;grid-template-columns:1fr;gap:16px}
@media(min-width:600px){.products{grid-template-columns:1fr 1fr}}
.card{background:#111827;border-radius:14px;padding:18px;box-shadow:0 4px 14px rgba(0,0,0,.4);text-align:center}
.card h2{font-size:1.3rem}
.price{font-size:1.6rem;font-weight:700;color:#38bdf8;margin:8px 0 12px;text-align:center}
.qty-box{display:flex;justify-content:center;align-items:center;gap:14px}
.qty-btn{width:42px;height:42px;border:none;background:#38bdf8;color:#020617;font-size:22px;border-radius:10px;cursor:pointer}
.qty-number{font-size:20px;font-weight:700;width:44px;text-align:center}
.order-box{margin-top:28px;background:#111827;border-radius:16px;padding:20px;box-shadow:0 4px 14px rgba(0,0,0,.4)}
.order-box h2{text-align:center;margin-bottom:16px;font-size:1.4rem}
.field{margin-bottom:14px}
.field label{display:block;margin-bottom:6px;font-weight:600;font-size:0.95rem}
.field input,.field textarea{width:100%;padding:12px;border-radius:10px;border:none;font-size:16px}
.field textarea{min-height:80px}
.summary{background:#020617;border-radius:12px;padding:14px;margin:16px 0}
.summary-row{display:flex;justify-content:space-between;margin-bottom:6px;font-size:0.95rem}
.summary-total{border-top:2px solid #38bdf8;padding-top:8px;margin-top:8px;font-size:1.1rem;font-weight:700}
.submit-btn{width:100%;padding:14px;background:#38bdf8;color:#020617;border:none;border-radius:12px;font-size:1.05rem;font-weight:700;cursor:pointer}
.success{display:none;background:#14532d;border:2px solid #22c55e;padding:16px;border-radius:12px;margin-top:14px;text-align:center}
.admin-btn{position:fixed;bottom:16px;left:16px;background:#020617;color:white;padding:10px 16px;border-radius:10px;text-decoration:none;font-size:0.9rem}
.admin-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:1000}
.admin-box{background:#020617;max-width:92%;margin:40px auto;padding:18px;border-radius:14px;position:relative}
.close-btn{position:absolute;top:10px;left:10px;background:#dc2626;color:white;border:none;padding:6px 12px;border-radius:8px;cursor:pointer;font-size:0.85rem}
.login-box{text-align:center;padding-top:20px}
.login-box h2{font-size:1.3rem;margin-bottom:12px}
.login-box input{padding:12px;font-size:16px;width:100%;max-width:260px;margin-bottom:12px;border-radius:10px;border:none}
.login-box button{padding:10px 24px;background:#38bdf8;color:#020617;border:none;border-radius:10px;font-size:0.95rem;font-weight:700;cursor:pointer}
.orders{display:none}
.order-card{background:#111827;border-radius:10px;padding:12px;margin-bottom:10px;border:1px solid #1e293b;font-size:0.9rem}
</style>
</head>
<body>

<header>
    <h1>UT Bakery</h1>
    <p>הזמנה מהירה, משלוח אישי</p>
</header>

<div class="container">
    <div class="products">
        <div class="card">
            <h2>עוגיות</h2>
            <div class="price">₪3</div>
            <div class="qty-box">
                <button class="qty-btn" onclick="changeQty('cookies',-1)">-</button>
                <div class="qty-number" id="cookiesQty">0</div>
                <button class="qty-btn" onclick="changeQty('cookies',1)">+</button>
            </div>
        </div>

        <div class="card">
            <h2>רצועות עוגה</h2>
            <div class="price">₪5</div>
            <div class="qty-box">
                <button class="qty-btn" onclick="changeQty('strips',-1)">-</button>
                <div class="qty-number" id="stripsQty">0</div>
                <button class="qty-btn" onclick="changeQty('strips',1)">+</button>
            </div>
        </div>
    </div>

    <div class="order-box">
        <h2>טופס הזמנה</h2>
        <form id="orderForm">
            <div class="field">
                <label>שם מלא</label>
                <input type="text" id="name" required>
            </div>
            <div class="field">
                <label>טלפון</label>
                <input type="tel" id="phone" required>
            </div>
            <div class="field">
                <label>כתובת</label>
                <textarea id="address" required></textarea>
            </div>

            <div class="summary">
                <div class="summary-row">
                    <span>עוגיות (<span id="cookiesSum">0</span>)</span>
                    <span id="cookiesPrice">₪0</span>
                </div>
                <div class="summary-row">
                    <span>רצועות עוגה (<span id="stripsSum">0</span>)</span>
                    <span id="stripsPrice">₪0</span>
                </div>
                <div class="summary-total">
                    <span>סה"כ:</span>
                    <span id="totalPrice">₪0</span>
                </div>
            </div>
            <button type="submit" class="submit-btn">שלח הזמנה</button>
        </form>
        <div class="success" id="successBox">ההזמנה התקבלה בהצלחה!</div>
    </div>
</div>

<a href="#" class="admin-btn" onclick="openAdmin();return false;">ניהול</a>

<div class="admin-overlay" id="adminOverlay">
    <div class="admin-box">
        <button class="close-btn" onclick="closeAdmin()">סגור</button>

        <div class="login-box" id="loginBox">
            <h2>כניסה לניהול</h2>
            <input type="password" id="adminPass" placeholder="סיסמה"><br>
            <button onclick="login()">התחבר</button>
        </div>

        <div class="orders" id="ordersBox">
            <h2 style="text-align:center;margin-bottom:14px;">רשימת הזמנות</h2>
            <div id="ordersList"></div>
        </div>
    </div>
</div>

<script>
const prices = {cookies:3, strips:5};
const qty = {cookies:0, strips:0};

// Airtable configuration
const airtablePat = 'pathehT0WhOARGJVP'; // your token
const airtableBaseId = 'fblVlQ20v5EqRG'; // your base id
const airtableTable = 'Orders'; // your table name

function changeQty(item,val){
    qty[item]=Math.max(0, qty[item]+val);
    document.getElementById(item+'Qty').textContent = qty[item];
    updateSummary();
}

function updateSummary(){
    document.getElementById('cookiesSum').textContent=qty.cookies;
    document.getElementById('stripsSum').textContent=qty.strips;

    const cookiesTotal = qty.cookies*prices.cookies;
    const stripsTotal = qty.strips*prices.strips;

    document.getElementById('cookiesPrice').textContent='₪'+cookiesTotal;
    document.getElementById('stripsPrice').textContent='₪'+stripsTotal;
    document.getElementById('totalPrice').textContent='₪'+(cookiesTotal+stripsTotal);
}

document.getElementById('orderForm').addEventListener('submit', async function(e){
    e.preventDefault();
    if(qty.cookies===0 && qty.strips===0){ alert('בחר לפחות מוצר אחד'); return; }

    const order = {
        fields: {
            Name: document.getElementById('name').value,
            Phone: document.getElementById('phone').value,
            Address: document.getElementById('address').value,
            Cookies: qty.cookies,
            Strips: qty.strips,
            Total: qty.cookies*prices.cookies + qty.strips*prices.strips,
            Created_At: new Date().toISOString()
        }
    };

    try {
        await axios.post(`https://api.airtable.com/v0/${airtableBaseId}/${airtableTable}`, order, {
            headers: {
                'Authorization': `Bearer ${airtablePat}`,
                'Content-Type': 'application/json'
            }
        });

        document.getElementById('successBox').style.display='block';
        this.reset();
        qty.cookies=0; qty.strips=0; updateSummary();
        document.getElementById('cookiesQty').textContent=0;
        document.getElementById('stripsQty').textContent=0;
    } catch(err){
        alert('שגיאה בשליחת ההזמנה. נסה שוב.');
        console.error(err);
    }
});

function openAdmin(){adminOverlay.style.display='block'}
function closeAdmin(){
    adminOverlay.style.display='none';
    loginBox.style.display='block';
    ordersBox.style.display='none';
    adminPass.value='';
}

async function login(){
    if(adminPass.value==='4242'){ // admin password
        loginBox.style.display='none';
        ordersBox.style.display='block';
        await loadOrders();
    } else { alert('סיסמה שגויה'); }
}

async function loadOrders(){
    ordersList.innerHTML='';
    try {
        const res = await axios.get(`https://api.airtable.com/v0/${airtableBaseId}/${airtableTable}`, {
            headers: { 'Authorization': `Bearer ${airtablePat}` }
        });
        const records = res.data.records;
        if(records.length===0){ ordersList.innerHTML='<p style="text-align:center;">אין הזמנות</p>'; return; }

        records.forEach(o=>{
            const f = o.fields;
            const d = document.createElement('div');
            d.className='order-card';
            d.innerHTML=`
                <strong>${f.Created_At}</strong><br>
                שם: ${f.Name}<br>
                טלפון: ${f.Phone}<br>
                כתובת: ${f.Address}<br>
                עוגיות: ${f.Cookies} | רצועות: ${f.Strips}<br>
                סה"כ: ₪${f.Total}
            `;
            ordersList.appendChild(d);
        });
    } catch(err){
        console.error(err);
        ordersList.innerHTML='<p style="text-align:center;">שגיאה בטעינת ההזמנות</p>';
    }
}
</script>

</body>
</html>
